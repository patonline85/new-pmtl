version: '3'

services:
  web:
    image: php:8.2-apache
    container_name: news-web
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      # Thay vì map ra đường dẫn cụ thể, ta dùng Named Volume (Docker tự quản lý)
      - news_data:/var/www/html/data
    
    # DÒNG QUAN TRỌNG: Tự động cấp quyền cho PHP ghi được dữ liệu khi khởi động
    # Nó sẽ chạy lệnh chown trước, sau đó mới bật Apache
    command: >
      sh -c "chown -R www-data:www-data /var/www/html/data && apache2-foreground"
      
    environment:
      - TZ=Asia/Ho_Chi_Minh

# Khai báo Volume do Docker quản lý
volumes:
  news_data: